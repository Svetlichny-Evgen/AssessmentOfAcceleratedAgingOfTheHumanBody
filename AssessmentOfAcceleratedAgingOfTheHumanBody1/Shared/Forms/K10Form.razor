<div class="questions">
    @foreach (var question in Questions)
    {
        <QuestionComponent TValue="string" QuestionId="@question.Id" QuestionText="@question.Text" Options="@question.Options" SelectedOption="@question.SelectedOption" SelectedOptionChanged="@((string value) => HandleSelectedOptionChanged(question, value))" />
        <br />
    }
    <button @onclick="SubmitSurvey">Отправить</button>
    <p>Количество ответов баллов: @totalScore</p>
    <p>Рівень якості життя: @result</p>
</div>

@code {
    int totalScore = 0;
    string result = "";
    private List<QuestionModel> Questions = new List<QuestionModel>
    {
        new QuestionModel {
            Id = "question1",
            Text = "1. Ви відчували себе виснаженим (виснаженою) без очевидної на це причини.",
            Options = new List<OptionsModel>
        {
            new OptionsModel { Value = "never", Text = "Ніколи" },
            new OptionsModel { Value = "rarely", Text = "Рідко" },
            new OptionsModel { Value = "somtimes", Text = "Іноді" },
            new OptionsModel { Value = "often", Text = "Часто" },
            new OptionsModel { Value = "always", Text = "Завжди" }
        },
            SelectedOption = ""
        },
        new QuestionModel {
            Id = "question2",
            Text = "2. Ви були знервованим (знервованою).",
            Options = new List<OptionsModel>
        {
            new OptionsModel { Value = "never", Text = "Ніколи" },
            new OptionsModel { Value = "rarely", Text = "Рідко" },
            new OptionsModel { Value = "somtimes", Text = "Іноді" },
            new OptionsModel { Value = "often", Text = "Часто" },
            new OptionsModel { Value = "always", Text = "Завжди" }
        },
            SelectedOption = ""
        },
        new QuestionModel {
            Id = "question3",
            Text = "3. Ви так сильно нервували, що нічого не могло вас заспокоїти.",
            Options = new List<OptionsModel>
        {
            new OptionsModel { Value = "never", Text = "Ніколи" },
            new OptionsModel { Value = "rarely", Text = "Рідко" },
            new OptionsModel { Value = "somtimes", Text = "Іноді" },
            new OptionsModel { Value = "often", Text = "Часто" },
            new OptionsModel { Value = "always", Text = "Завжди" }
        },
            SelectedOption = ""
        },
        new QuestionModel {
            Id = "question4",
            Text = "4. Ви відчували розпач/безнадію.",
            Options = new List<OptionsModel>
        {
            new OptionsModel { Value = "never", Text = "Ніколи" },
            new OptionsModel { Value = "rarely", Text = "Рідко" },
            new OptionsModel { Value = "somtimes", Text = "Іноді" },
            new OptionsModel { Value = "often", Text = "Часто" },
            new OptionsModel { Value = "always", Text = "Завжди" }
        },
            SelectedOption = ""
        },
        new QuestionModel {
            Id = "question5",
            Text = "5. Ви були неспокійним (неспокійною) або метушливим (метушливою).",
            Options = new List<OptionsModel>
        {
            new OptionsModel { Value = "never", Text = "Ніколи" },
            new OptionsModel { Value = "rarely", Text = "Рідко" },
            new OptionsModel { Value = "somtimes", Text = "Іноді" },
            new OptionsModel { Value = "often", Text = "Часто" },
            new OptionsModel { Value = "always", Text = "Завжди" }
        },
            SelectedOption = ""
        },
        new QuestionModel {
            Id = "question6",
            Text = "6. Ви були настільки неспокійним (неспокійною), що не могли всидіти на місці.",
            Options = new List<OptionsModel>
        {
            new OptionsModel { Value = "never", Text = "Ніколи" },
            new OptionsModel { Value = "rarely", Text = "Рідко" },
            new OptionsModel { Value = "somtimes", Text = "Іноді" },
            new OptionsModel { Value = "often", Text = "Часто" },
            new OptionsModel { Value = "always", Text = "Завжди" }
        },
            SelectedOption = ""
        },
        new QuestionModel {
            Id = "question7",
            Text = "7. Ви відчували себе пригнічено.",
            Options = new List<OptionsModel>
        {
            new OptionsModel { Value = "never", Text = "Ніколи" },
            new OptionsModel { Value = "rarely", Text = "Рідко" },
            new OptionsModel { Value = "somtimes", Text = "Іноді" },
            new OptionsModel { Value = "often", Text = "Часто" },
            new OptionsModel { Value = "always", Text = "Завжди" }
        },
            SelectedOption = ""
        },
        new QuestionModel {
            Id = "question8",
            Text = "8. Ви відчували, що все вимагає зусиль.",
            Options = new List<OptionsModel>
        {
            new OptionsModel { Value = "never", Text = "Ніколи" },
            new OptionsModel { Value = "rarely", Text = "Рідко" },
            new OptionsModel { Value = "somtimes", Text = "Іноді" },
            new OptionsModel { Value = "often", Text = "Часто" },
            new OptionsModel { Value = "always", Text = "Завжди" }
        },
            SelectedOption = ""
        },
        new QuestionModel {
            Id = "question9",
            Text = "9. Ви були настільки сумним (сумною), що нічого не могло вам покращити настрій.",
            Options = new List<OptionsModel>
        {
            new OptionsModel { Value = "never", Text = "Ніколи" },
            new OptionsModel { Value = "rarely", Text = "Рідко" },
            new OptionsModel { Value = "somtimes", Text = "Іноді" },
            new OptionsModel { Value = "often", Text = "Часто" },
            new OptionsModel { Value = "always", Text = "Завжди" }
        },
            SelectedOption = ""
        },
        new QuestionModel {
            Id = "question10",
            Text = "10. Ви відчували себе нікчемною людиною.",
            Options = new List<OptionsModel>
        {
            new OptionsModel { Value = "never", Text = "Ніколи" },
            new OptionsModel { Value = "rarely", Text = "Рідко" },
            new OptionsModel { Value = "somtimes", Text = "Іноді" },
            new OptionsModel { Value = "often", Text = "Часто" },
            new OptionsModel { Value = "always", Text = "Завжди" }
        },
            SelectedOption = ""
        }
    };

    private int CalculateTotalScore(List<QuestionModel> questions)
    {
        int score = 0;
        foreach (var question in questions)
        {
            if (!string.IsNullOrEmpty(question.SelectedOption))
            {
                switch (question.SelectedOption)
                {
                    case "never":
                        score += 1;
                        break;
                    case "rarely":
                        score += 2;
                        break;
                    case "somtimes":
                        score += 3;
                        break;
                    case "often":
                        score += 4;
                        break;
                    case "always":
                        score += 5;
                        break;
                    default:
                        break;
                }
            }
        }
        return score;
    }

    private async Task HandleSelectedOptionChanged(QuestionModel question, string selectedOption)
    {
        question.SelectedOption = selectedOption;
        totalScore = CalculateTotalScore(Questions);
    }

    private async Task SubmitSurvey()
    {
        totalScore = CalculateTotalScore(Questions);
        if (totalScore > 0 && totalScore <= 20)
        {
            result = "Ймовірно що виснаження від стресу відсутнє.";
        }
        else if (totalScore > 20 && totalScore <= 29)
        {
            result = "Легке психоемоційне виснаження. Необхідно звернутися до психолога, психотерапевта.";
        }
        else if (totalScore > 29 && totalScore <= 35)
        {
            result = "Психологічне виснаження середнього рівня. Необхідно звернутися до психолога, психотерапевта.";
        }
        else if (totalScore > 35)
        {
            result = "Психоемоційне виснаження високого рівня. Необхідно звернутися до психолога, психотерапевта.";
        }
    }
}
